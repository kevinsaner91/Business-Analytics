---
title: "Assignment Data Analysis"
author: "Kevin Saner, Phillip Gachnang, Raphael Denz"
date: "18 3 2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Starting situation
Description of the dataset.

## To-Do
Description of the tasks.

## Prerequisites
```{r, message=FALSE,warning=FALSE}
library(DescTools) # for CramerV() function
library(haven) # to read SPSS files
library(labelled) # to deal with variable and value labels
library(knitr) # to get the kable() function for nice tables
library(gplots) # to get the plotmeans() function
library(ggplot2)
```


```{r message=FALSE, warning=FALSE, include=FALSE}
rm(list = ls()) # clear workspace, use if needed
dataset = read_sav("npd.sav")

```

# Data Preparation

## Check the dimension and the variables

*Check the dimensions of the data set.*

```{r}
a<- dim(dataset)
a

```

The dataset contains `r a[1]` observations and `r a[2]` variables.

```{r}
names(dataset)
```
The names of the variables match the questions of the questionnaire.

The variables are not labelled.

## Response

*Calculate the unit response rate.*

```{r}
gross_sample_size <- 592
# keep only rows that indicated completeness
dataset <- subset(dataset,dataset$COMPLETE!="")
100 /gross_sample_size * nrow(dataset)

```


## Measurement Levels and Missingness

*Check the measurement levels and missigness of sections C & D.*

### Measurement Levels

The measurement levels of the variables in section C & D are follows:

* C1 - C4 are ratios
* C 5 -7 are ordinally scaled variable
* C8, C9 & D1 are ratios
* D2 is a nominal variable
* D3 is a nominal variable that uses one-hot encoding
* D4 - D8 are ratios
* D9IncYes1 is a nominal variable
* D9 is 

To make the data better readable it is useful to label the ordinal and nominal variables. 
Variables C5 - C7 follow a 7-level Likert Scale, therefore the labels will be:  

1 = Strongly Disagree  
2 = Disagree  
3 = Somewhat Disagree  
4 = Neither Agree or Disagree  
5 = Somewhat Agree  
6 = Agree  
7 = Strongly Agree

```{r}
# transform the variables to factor and add labels
to_7_level_likert <- function(x){
x <- factor(x,
                     levels = c(1,2,3,4,5,6,7), 
                     labels = c("Strongly Disagree",
                                "Disagree",
                                "Somewhat Disagree",
                                "Neither Agree or Disagree",
                                "Somewhat Agree",
                                "Agree",
                                "Strongly Agree"),
                     ordered = TRUE)
}
dataset$C5 <- to_7_level_likert(dataset$C5)
dataset$C6 <- to_7_level_likert(dataset$C6)
dataset$C7 <- to_7_level_likert(dataset$C7)
# example
levels(dataset$C5)

```
D2 and D9IncYes1 are nominal variables with two levels each. The variables are also transformed to factors and labels are added.
```{r}
dataset$D2 <- factor(dataset$D2,
                     levels = c(1,2),
                     labels = c("Privately held","Publicly Traded"),
                     ordered = FALSE)
dataset$D9IncYes1 <- factor(dataset$D9IncYes1,
                            levels = c(0,1),
                            labels = c("No","Yes"),
                            ordered = FALSE)
summary(dataset$D2)
summary(dataset$D9IncYes1)

```

### Missingness

*Check data for missing values in sections C and D.*

```{r}
#create a subset that only contains sections C and D
dataset_c_d <- dataset[,grep("C1",colnames(dataset)):grep("D9EGov",colnames(dataset))]
out <- table(sapply(dataset_c_d, is.na))
out

```
There are `r out[2]`  missing values in the data set. The values are distributed as follows among the variables:

```{r}
data.frame(colSums(is.na(dataset_c_d)))
```


 

## Missingness of D9IncYes1

```{r}
# contingency table


table(is.na(dataset$D4),is.na(dataset$D9IncYes1))


```
223 have answered both questions. 9 have answered neither D4 nor D9IncYes1. 10 have answered D4 but not D9IncYes1. 4 have answered D9IncYes1 but not D4.

```{r}
#make a subset with only the variables of interest
dataset_D4_D9IncYes1 <- dataset[,c("D4","D9IncYes1")]
#keep only rows where the company size is meaningful
dataset_D4_D9IncYes1<- subset(dataset_D4_D9IncYes1,!is.na(dataset$D4))

ggplot(dataset_D4_D9IncYes1, aes(x=D9IncYes1,y=D4)) + geom_boxplot(outlier.colour = NA) +  coord_cartesian(ylim = c(0, 60))

```

```{r}
# test for a statistically significant difference between yes and no
wilcox.test(dataset$D4[which(dataset$D9IncYes1=="Yes")],dataset$D4[which(dataset$D9IncYes1=="No")])

```

Reject H0, companies that did not participate in an incubator program are bigger.

# Analysis

## Proportion of Programme 

*Calculate the proportion and 95% confidence interval for incubator participants.*

```{r}
#get rid of NAs
D9IncAll <- length(subset(dataset$D9IncYes1,!is.na(dataset$D9IncYes1)))
D9IncYes <- length(subset(dataset$D9IncYes1,dataset$D9IncYes1=="Yes"))

prop.test(D9IncYes,D9IncAll,correct = FALSE)

```


## Satisfaction with product development process

## Association of incubator participation and satisfaction with the product development process

## Number of R+D personnel

## R+D personnel vs participation

```{r}
# Fabian showed this during the lecture use as base for the solution
x<-rnorm(1000,0,1)
f<-fsample(c(0,1),size=1000,replace=TRUE)
mydf<-data.frame(x=x,f=f)
aggregate(mydf$x,by=list(f),qqnorm)

```


## Including Plots (to be deleted, just an example)

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
